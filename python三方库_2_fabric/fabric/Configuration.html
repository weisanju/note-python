<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Configuration</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../index.html">我的笔记库</a></li><li class="chapter-item expanded affix "><li class="part-title">python基础</li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/index.html"><strong aria-hidden="true">1.</strong> python基础</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../python基础_1_python基础/1.python3基础语法.html"><strong aria-hidden="true">1.1.</strong> python3基础语法</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/2.基本数据类型.html"><strong aria-hidden="true">1.2.</strong> 基本数据类型</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/3.Python3数据类型转换.html"><strong aria-hidden="true">1.3.</strong> Python3数据类型转换</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/4.Python推导式.html"><strong aria-hidden="true">1.4.</strong> Python推导式</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/5.Python3运算符.html"><strong aria-hidden="true">1.5.</strong> Python3运算符</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/6.Python3字符串.html"><strong aria-hidden="true">1.6.</strong> Python3字符串</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/7.python3列表.html"><strong aria-hidden="true">1.7.</strong> python3列表</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/8.元祖.html"><strong aria-hidden="true">1.8.</strong> 元祖</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/9.Python3字典.html"><strong aria-hidden="true">1.9.</strong> Python3字典</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/10.Python3集合.html"><strong aria-hidden="true">1.10.</strong> Python3集合</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/11.Number类型.html"><strong aria-hidden="true">1.11.</strong> Number类型</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/12.python3流程控制.html"><strong aria-hidden="true">1.12.</strong> python3流程控制</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/13.Python3迭代器与生成器.html"><strong aria-hidden="true">1.13.</strong> Python3迭代器与生成器</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/14.函数.html"><strong aria-hidden="true">1.14.</strong> 函数</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/15.Python3JSON数据解析.html"><strong aria-hidden="true">1.15.</strong> Python3JSON数据解析</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/16.Python3面向对象.html"><strong aria-hidden="true">1.16.</strong> Python3面向对象</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/17.模块与包.html"><strong aria-hidden="true">1.17.</strong> 模块与包</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/With关键字.html"><strong aria-hidden="true">1.18.</strong> With关键字</a></li><li class="chapter-item expanded "><a href="../../python基础_1_python基础/杂项.html"><strong aria-hidden="true">1.19.</strong> 杂项</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">python三方库</li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> fabric</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../python三方库_2_fabric/fabric/index.html"><strong aria-hidden="true">2.1.</strong> fabric</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../python三方库_2_fabric/fabric/Configuration.html" class="active"><strong aria-hidden="true">2.1.1.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../../python三方库_2_fabric/fabric/README_1.x.html"><strong aria-hidden="true">2.1.2.</strong> README_1.x</a></li></ol></li><li class="chapter-item expanded "><a href="../../python三方库_2_fabric/invoke/index.html"><strong aria-hidden="true">2.2.</strong> invoke</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../python三方库_2_fabric/invoke/1.DefiningAndRunningTask.html"><strong aria-hidden="true">2.2.1.</strong> DefiningAndRunningTask</a></li><li class="chapter-item expanded "><a href="../../python三方库_2_fabric/invoke/2.InvokeCoreUsage.html"><strong aria-hidden="true">2.2.2.</strong> InvokeCoreUsage</a></li><li class="chapter-item expanded "><a href="../../python三方库_2_fabric/invoke/3.Configuration.html"><strong aria-hidden="true">2.2.3.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../../python三方库_2_fabric/invoke/4.loadingCollections.html"><strong aria-hidden="true">2.2.4.</strong> loadingCollections</a></li><li class="chapter-item expanded "><a href="../../python三方库_2_fabric/invoke/5.UsingInvokeAslibrary.html"><strong aria-hidden="true">2.2.5.</strong> UsingInvokeAslibrary</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>Invoke提供了一种多方面的配置机制，允许您通过配置文件、环境变量、任务名称空间和CLI标志的层次结构来配置核心行为和任务的行为。</p>
<p>配置搜索，加载，解析和合并的最终结果是一个Config对象，它的行为就像一个 (嵌套的) Python字典。Invoke在运行时引用此对象 (确定诸如Context.run之类的方法的默认行为)，并将其作为Context.config或 Context 本身的速记属性访问方式公开给用户的任务。</p>
<h2 id="the-configuration-hierarchy"><a class="header" href="#the-configuration-hierarchy">The configuration hierarchy</a></h2>
<p>简而言之，配置值相互覆盖的顺序如下:</p>
<ol>
<li>
<p><strong>Internal default values</strong> ：默认值</p>
</li>
<li>
<p><strong>Collection-driven configurations</strong>   通过 <a href="https://docs.pyinvoke.org/en/latest/api/collection.html#invoke.collection.Collection.configure"><code>Collection.configure</code></a> 定义，Sub-collections的配置被合并到顶级集合中，最终结果构成了整个配置设置的基础。</p>
</li>
<li>
<p><strong>System-level configuration file</strong> stored in <code>/etc/</code>, such as <code>/etc/invoke.yaml</code></p>
</li>
<li>
<p><strong>User-level configuration file</strong> found in the running user’s home directory, e.g. <code>~/.invoke.yaml</code>.</p>
</li>
<li>
<p><strong>Project-level configuration file</strong> living next to your top level <code>tasks.py</code>. For example, if your run of Invoke loads <code>/home/user/myproject/tasks.py</code> (see our docs on <a href="https://docs.pyinvoke.org/en/latest/concepts/loading.html">the load process</a>), this might be <code>/home/user/myproject/invoke.yaml</code>.</p>
</li>
<li>
<p><strong>Environment variables</strong> found in the invoking shell environment.</p>
<blockquote>
<ul>
<li>These aren’t as strongly hierarchical as the rest, nor is the shell environment namespace owned wholly by Invoke, so we must rely on slightly verbose prefixing instead - see <a href="https://docs.pyinvoke.org/en/latest/concepts/configuration.html#env-vars">Environment variables</a> for details.</li>
</ul>
</blockquote>
</li>
<li>
<p><strong>Runtime configuration file</strong> whose path is given to <a href="https://docs.pyinvoke.org/en/latest/invoke.html#cmdoption-f"><code>-f</code></a>, e.g. <code>inv -f /random/path/to/config_file.yaml</code>. This path may also be set via the <code>INVOKE_RUNTIME_CONFIG</code> env var.</p>
</li>
<li>
<p><strong>Command-line flags</strong> for certain core settings, such as <a href="https://docs.pyinvoke.org/en/latest/invoke.html#cmdoption-e"><code>-e</code></a>.</p>
</li>
<li>
<p><strong>Modifications made by user code</strong> at runtime.</p>
</li>
</ol>
<h2 id="default-configuration-values"><a class="header" href="#default-configuration-values">Default configuration values</a></h2>
<p>下面列出了所有配置值和/或section Invoke本身用于控制行为的列表，例如Context.run的echo和pty标志，任务重复数据删除等。</p>
<p>这些值的存储位置在Config类内部，特别是Config.global_defaults的返回值; 有关更多详细信息，请参见其API文档。</p>
<p>For convenience, we refer to nested setting names with a dotted syntax, so e.g. <code>foo.bar</code> refers to what would be (in a Python config context) <code>{'foo': {'bar': &lt;value here&gt;}}</code>. Typically, these can be read or set on <a href="https://docs.pyinvoke.org/en/latest/api/config.html#invoke.config.Config"><code>Config</code></a> and <a href="https://docs.pyinvoke.org/en/latest/api/context.html#invoke.context.Context"><code>Context</code></a> objects using attribute syntax, which looks nearly identical: <code>c.foo.bar</code>.</p>
<p>为了方便起见，我们引用带有点语法的嵌套设置名称，例如foo.bar指的是 (在Python config上下文中) <code>{'foo': {'bar': &lt;value here &gt;}}</code>。通常，可以使用属性语法在Config和Context对象上读取或设置这些语法，这些语法看起来几乎相同: c.foo.bar。</p>
<p>任务配置树保存与任务执行相关的设置。</p>
<ul>
<li>
<p><code>tasks.dedupe</code> controls <a href="https://docs.pyinvoke.org/en/latest/concepts/invoking-tasks.html#deduping">Task deduplication</a> and defaults to <code>True</code>. It can also be overridden at runtime via <a href="https://docs.pyinvoke.org/en/latest/invoke.html#cmdoption-no-dedupe"><code>--no-dedupe</code></a>.</p>
</li>
<li>
<p><code>tasks.auto_dash_names</code> 控制任务名称和集合名称是否已将下划线转到CLI上的破折号。 Default: <code>True</code>. See also <a href="https://docs.pyinvoke.org/en/latest/concepts/namespaces.html#dashes-vs-underscores">Dashes vs underscores</a>.</p>
</li>
<li>
<p><code>tasks.collection_name</code> controls the Python import name sought out by <a href="https://docs.pyinvoke.org/en/latest/concepts/loading.html#collection-discovery">collection discovery</a>, and defaults to <code>&quot;tasks&quot;</code>.</p>
</li>
<li>
<p><code>tasks.executor_class</code> allows users to override the class instantiated and used for task execution.</p>
</li>
</ul>
<p>Must be a fully-qualified dotted path of the form <code>module(.submodule...).class</code>, where all but <code>.class</code> will be handed to <a href="https://docs.python.org/2.7/library/importlib.html#importlib.import_module"><code>importlib.import_module</code></a>, and <code>class</code> is expected to be an attribute on that resulting module object.</p>
<p>Defaults to <code>None</code>, meaning to use the running <a href="https://docs.pyinvoke.org/en/latest/api/program.html#invoke.program.Program"><code>Program</code></a> object’s <code>executor_class</code> attribute.</p>
<p>Warning</p>
<p>Take care if using this setting in tandem with <a href="https://docs.pyinvoke.org/en/latest/concepts/library.html#reusing-as-a-binary">custom program binaries</a>, since custom programs may specify their own default executor class (which your use of this setting will override!) and assume certain behaviors stemming from that.</p>
<p><code>tasks.search_root</code> allows overriding the default <a href="https://docs.pyinvoke.org/en/latest/concepts/loading.html#collection-discovery">collection discovery</a> root search location. It defaults to <code>None</code>, which indicates to use the executing process’ current working directory.</p>
<ul>
<li>
<p>The <code>run</code> tree controls the behavior of <a href="https://docs.pyinvoke.org/en/latest/api/runners.html#invoke.runners.Runner.run"><code>Runner.run</code></a>. Each member of this tree (such as <code>run.echo</code> or <code>run.pty</code>) maps directly to a <a href="https://docs.pyinvoke.org/en/latest/api/runners.html#invoke.runners.Runner.run"><code>Runner.run</code></a> keyword argument of the same name; see that method’s docstring for details on what these settings do &amp; what their default values are.</p>
</li>
<li>
<p>• 运行 • 树控制 • Runner.ru n • 的行为。此树的每个成员 (例如 • run.echo • 或 • run.pt y •) 直接映射到具有相同名称的 • Runner.ru n • 关键字参数; 有关这些设置的功能和默认值的详细信息，请参阅该方法的docstring。</p>
</li>
<li>
<p>The <code>runners</code> tree controls <em>which</em> runner classes map to which execution contexts; if you’re using Invoke by itself, this will only tend to have a single member, <code>runners.local</code>. Client libraries may extend it with additional key/value pairs, such as <code>runners.remote</code>.</p>
</li>
<li>
<p>The <code>sudo</code> tree controls the behavior of <a href="https://docs.pyinvoke.org/en/latest/api/context.html#invoke.context.Context.sudo"><code>Context.sudo</code></a>:</p>
<blockquote>
<ul>
<li>
<p><code>sudo.password</code> controls the autoresponse password submitted to sudo’s password prompt. Default: <code>None</code>.</p>
<p>Warning</p>
<p>While it’s possible to store this setting, like any other, in <a href="https://docs.pyinvoke.org/en/latest/concepts/configuration.html#">configuration files</a> – doing so is inherently insecure. We highly recommend filling this config value in at runtime from a secrets management system of some kind.</p>
</li>
<li>
<p><code>sudo.prompt</code> holds the sudo password prompt text, which is both supplied to <code>sudo -p</code>, and searched for when performing <a href="https://docs.pyinvoke.org/en/latest/concepts/watchers.html">auto-response</a>. Default: <code>[sudo] password:</code>.</p>
</li>
</ul>
</blockquote>
</li>
<li>
<p>A top level config setting, <code>debug</code>, controls whether debug-level output is logged; it defaults to <code>False</code>.</p>
<p><code>debug</code> can be toggled via the <a href="https://docs.pyinvoke.org/en/latest/invoke.html#cmdoption-d"><code>-d</code></a> CLI flag, which enables debugging after CLI parsing runs. It can also be toggled via the <code>INVOKE_DEBUG</code> environment variable which - unlike regular env vars - is honored from the start of execution and is thus useful for troubleshooting parsing and/or config loading.</p>
</li>
<li>
<p>A small config tree, <code>timeouts</code>, holds various kinds of timeout controls. At present, for Invoke, this only holds a <code>command</code> subkey, which controls subprocess execution timeouts.</p>
<blockquote>
<ul>
<li>Client code often adds more to this tree, and Invoke itself may add more in the future as well.</li>
</ul>
</blockquote>
</li>
</ul>
<h2 id="configuration-files"><a class="header" href="#configuration-files">Configuration files</a></h2>
<h3 id="loading"><a class="header" href="#loading">Loading</a></h3>
<p>For each configuration file location mentioned in the previous section, we search for files ending in <code>.yaml</code>, <code>.yml</code>, <code>.json</code> or <code>.py</code> (<strong>in that order!</strong>), load the first one we find, and ignore any others that might exist.</p>
<p>For example, if Invoke is run on a system containing both <code>/etc/invoke.yml</code> <em>and</em> <code>/etc/invoke.json</code>, <strong>only the YAML file will be loaded</strong>. This helps keep things simple, both conceptually and in the implementation.</p>
<h3 id="format"><a class="header" href="#format">Format</a></h3>
<p>Invoke’s configuration allows arbitrary nesting, and thus so do our config file formats. All three of the below examples result in a configuration equivalent to <code>{'debug': True, 'run': {'echo': True}}</code>:</p>
<ul>
<li>
<p><strong>YAML</strong></p>
<pre><code>debug: true
run:
    echo: true
</code></pre>
</li>
<li>
<p><strong>JSON</strong></p>
<pre><code>{
    &quot;debug&quot;: true,
    &quot;run&quot;: {
        &quot;echo&quot;: true
    }
}
</code></pre>
</li>
<li>
<p><strong>Python</strong>:</p>
<pre><code>debug = True
run = {
    &quot;echo&quot;: True
}
</code></pre>
</li>
</ul>
<p>For further details, see these languages’ own documentation.</p>
<h2 id="environment-variables"><a class="header" href="#environment-variables">Environment variables</a></h2>
<p>Environment variables are a bit different from other configuration-setting methods, since they don’t provide a clean way to nest configuration keys, and are also implicitly shared amongst the entire system’s installed application base.</p>
<p>In addition, due to implementation concerns, env vars must be pre-determined by the levels below them in the config hierarchy (in other words - env vars may only be used to override existing config values). If you need Invoke to understand a <code>FOOBAR</code> environment variable, you must first declare a <code>foobar</code> setting in a configuration file or in your task collections.</p>
<h3 id="basic-rules"><a class="header" href="#basic-rules">Basic rules</a></h3>
<p>To mitigate the shell namespace problem, we simply prefix all our env vars with <code>INVOKE_</code>.</p>
<p>Nesting is performed via underscore separation, so a setting that looks like e.g. <code>{'run': {'echo': True}}</code> at the Python level becomes <code>INVOKE_RUN_ECHO=1</code> in a typical shell. See <a href="https://docs.pyinvoke.org/en/latest/concepts/configuration.html#env-var-nesting">Nesting vs underscored names</a> below for more on this.</p>
<h3 id="type-casting"><a class="header" href="#type-casting">Type casting</a></h3>
<p>Since env vars can only be used to override existing settings, the previous value of a given setting is used as a guide in casting the strings we get back from the shell:</p>
<ul>
<li>
<p>If the current value is a string or Unicode object, it is replaced with the value from the environment, with no casting whatsoever;</p>
<blockquote>
<ul>
<li>Depending on interpreter and environment, this means that a setting defaulting to a non-Unicode string type (eg a <code>str</code> on Python 2) may end up replaced with a Unicode string, or vice versa. This is intentional as it prevents users from accidentally limiting themselves to non-Unicode strings.</li>
</ul>
</blockquote>
</li>
<li>
<p>If the current value is <code>None</code>, it too is replaced with the string from the environment;</p>
</li>
<li>
<p>Booleans are set as follows: <code>0</code> and the empty value/string (e.g. <code>SETTING=</code>, or <code>unset SETTING</code>, or etc) evaluate to <code>False</code>, and any other value evaluates to <code>True</code>.</p>
</li>
<li>
<p>Lists and tuples are currently unsupported and will raise an exception;</p>
<blockquote>
<ul>
<li>In the future we may implement convenience transformations, such as splitting on commas to form a list; however since users can always perform such operations themselves, it may not be a high priority.</li>
</ul>
</blockquote>
</li>
<li>
<p>All other types - integers, longs, floats, etc - are simply used as constructors for the incoming value.</p>
<blockquote>
<ul>
<li>For example, a <code>foobar</code> setting whose default value is the integer <code>1</code> will run all env var inputs through <a href="https://docs.python.org/2.7/library/functions.html#int"><code>int</code></a>, and thus <code>FOOBAR=5</code> will result in the Python value <code>5</code>, not <code>&quot;5&quot;</code>.</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="nesting-vs-underscored-names"><a class="header" href="#nesting-vs-underscored-names">Nesting vs underscored names</a></h3>
<p>Since environment variable keys are single strings, we must use some form of string parsing to allow access to nested configuration settings. As mentioned above, in basic use cases this just means using an underscore character: <code>{'run': {'echo': True}}</code> becomes <code>INVOKE_RUN_ECHO=1</code>.</p>
<p>However, ambiguity is introduced when the settings names themselves contain underscores: is <code>INVOKE_FOO_BAR=baz</code> equivalent to <code>{'foo': {'bar': 'baz'}}</code>, or to <code>{'foo_bar': 'baz'}</code>? Thankfully, because env vars can only be used to modify settings declared at the Python level or in config files, we look at the current state of the config to determine the answer.</p>
<p>There is still a corner case where <em>both</em> possible interpretations exist as valid config paths (e.g. <code>{'foo': {'bar': 'default'}, 'foo_bar': 'otherdefault'}</code>). In this situation, we honor the <a href="http://zen-of-python.info/in-the-face-of-ambiguity-refuse-the-temptation-to-guess.html#12">Zen of Python</a> and refuse to guess; an error is raised instead, counseling users to modify their configuration layout or avoid using env vars for the setting in question.</p>
<h2 id="collection-based-configuration"><a class="header" href="#collection-based-configuration"><a href="https://docs.pyinvoke.org/en/latest/api/collection.html#invoke.collection.Collection"><code>Collection</code></a>-based configuration</a></h2>
<p><a href="https://docs.pyinvoke.org/en/latest/api/collection.html#invoke.collection.Collection"><code>Collection</code></a> objects may contain a config mapping, set via <a href="https://docs.pyinvoke.org/en/latest/api/collection.html#invoke.collection.Collection.configure"><code>Collection.configure</code></a>, and (as per <a href="https://docs.pyinvoke.org/en/latest/concepts/configuration.html#config-hierarchy">the hierarchy</a>) this typically forms the lowest level of configuration in the system.</p>
<p>When collections are <a href="https://docs.pyinvoke.org/en/latest/concepts/namespaces.html">nested</a>, configuration is merged ‘downwards’ by default: when conflicts arise, outer namespaces closer to the root will win, versus inner ones closer to the task being invoked.</p>
<p>Note</p>
<p>‘Inner’ tasks here are specifically those on the path from the root to the one housing the invoked task. ‘Sibling’ subcollections are ignored.</p>
<p>A quick example of what this means:</p>
<pre><code>from invoke import Collection, task

# This task &amp; collection could just as easily come from
# another module somewhere.
@task
def mytask(c):
    print(c['conflicted'])
inner = Collection('inner', mytask)
inner.configure({'conflicted': 'default value'})

# Our project's root namespace.
ns = Collection(inner)
ns.configure({'conflicted': 'override value'})
</code></pre>
<p>The result of calling <code>inner.mytask</code>:</p>
<pre><code>$ inv inner.mytask
override value
</code></pre>
<h2 id="example-of-real-world-config-use"><a class="header" href="#example-of-real-world-config-use">Example of real-world config use</a></h2>
<p>The previous sections had small examples within them; this section provides a more realistic-looking set of examples showing how the config system works.</p>
<h3 id="setup"><a class="header" href="#setup">Setup</a></h3>
<p>We’ll start out with semi-realistic tasks that hardcode their values, and build up to using the various configuration mechanisms. A small module for building <a href="http://sphinx-doc.org/">Sphinx</a> docs might begin like this:</p>
<pre><code>from invoke import task

@task
def clean(c):
    c.run(&quot;rm -rf docs/_build&quot;)

@task
def build(c):
    c.run(&quot;sphinx-build docs docs/_build&quot;)
</code></pre>
<p>Then maybe you refactor the build target:</p>
<pre><code>target = &quot;docs/_build&quot;

@task
def clean(c):
    c.run(&quot;rm -rf {}&quot;.format(target))

@task
def build(c):
    c.run(&quot;sphinx-build docs {}&quot;.format(target))
</code></pre>
<p>We can also allow runtime parameterization:</p>
<pre><code>default_target = &quot;docs/_build&quot;

@task
def clean(c, target=default_target):
    c.run(&quot;rm -rf {}&quot;.format(target))

@task
def build(c, target=default_target):
    c.run(&quot;sphinx-build docs {}&quot;.format(target))
</code></pre>
<p>This task module works for a single set of users, but what if we want to allow reuse? Somebody may want to use this module with a different default target. Using the configuration data (made available via the context arg) to configure these settings is usually the better solution [<a href="https://docs.pyinvoke.org/en/latest/concepts/configuration.html#id3">1]</a>.</p>
<h3 id="configuring-via-task-collection"><a class="header" href="#configuring-via-task-collection">Configuring via task collection</a></h3>
<p>The configuration <a href="https://docs.pyinvoke.org/en/latest/api/collection.html#invoke.collection.Collection.configure"><code>setting</code></a> and <a href="https://docs.pyinvoke.org/en/latest/api/context.html#invoke.context.Context.config"><code>getting</code></a> APIs enable moving otherwise ‘hardcoded’ default values into a config structure which downstream users are free to redefine. Let’s apply this to our example. First we add an explicit namespace object:</p>
<pre><code>from invoke import Collection, task

default_target = &quot;docs/_build&quot;

@task
def clean(c, target=default_target):
    c.run(&quot;rm -rf {}&quot;.format(target))

@task
def build(c, target=default_target):
    c.run(&quot;sphinx-build docs {}&quot;.format(target))

ns = Collection(clean, build)
</code></pre>
<p>Then we can move the default build target value into the collection’s default configuration, and refer to it via the context. At this point we also change our kwarg default value to be <code>None</code> so we can determine whether or not a runtime value was given. The result:</p>
<pre><code>@task
def clean(c, target=None):
    if target is None:
        target = c.sphinx.target
    c.run(&quot;rm -rf {}&quot;.format(target))

@task
def build(c, target=None):
    if target is None:
        target = c.sphinx.target
    c.run(&quot;sphinx-build docs {}&quot;.format(target))

ns = Collection(clean, build)
ns.configure({'sphinx': {'target': &quot;docs/_build&quot;}})
</code></pre>
<p>The result isn’t significantly more complex than what we began with, and as we’ll see next, it’s now trivial for users to override your defaults in various ways.</p>
<h3 id="configuration-overriding"><a class="header" href="#configuration-overriding">Configuration overriding</a></h3>
<p>The lowest-level override is, of course, just modifying the local <a href="https://docs.pyinvoke.org/en/latest/api/collection.html#invoke.collection.Collection"><code>Collection</code></a> tree into which a distributed module has been imported. E.g. if the above module is distributed as <code>myproject.docs</code>, someone can define a <code>tasks.py</code> that does this:</p>
<pre><code>from invoke import Collection, task
from myproject import docs

@task
def mylocaltask(c):
    # Some local stuff goes here
    pass

# Add 'docs' to our local root namespace, plus our own task
ns = Collection(mylocaltask, docs)
</code></pre>
<p>And then they can add this to the bottom:</p>
<pre><code># Our docs live in 'built_docs', not 'docs/_build'
ns.configure({'sphinx': {'target': &quot;built_docs&quot;}})
</code></pre>
<p>Now we have a <code>docs</code> sub-namespace whose build target defaults to <code>built_docs</code> instead of <code>docs/_build</code>. Runtime users can still override this via flags (e.g. <code>inv docs.build --target='some/other/dir'</code>) just as before.</p>
<p>If you prefer configuration files over in-Python tweaking of your namespace tree, that works just as well; instead of adding the line above to the previous snippet, instead drop this into a file next to <code>tasks.py</code> named <code>invoke.yaml</code>:</p>
<pre><code>sphinx:
    target: built_docs
</code></pre>
<p>For this example, that sort of local-to-project conf file makes the most sense, but don’t forget that the <a href="https://docs.pyinvoke.org/en/latest/concepts/configuration.html#config-hierarchy">config hierarchy</a> offers additional configuration methods which may be suitable depending on your needs.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../python三方库_2_fabric/fabric/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../python三方库_2_fabric/fabric/README_1.x.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../python三方库_2_fabric/fabric/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../python三方库_2_fabric/fabric/README_1.x.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
